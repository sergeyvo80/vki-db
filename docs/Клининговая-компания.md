[<<< назад](/README.md)

# Клининговая компания

- [Клининговая компания](#клининговая-компания)
  - [Описание предметной области](#описание-предметной-области)
    - [В данной области включены следующие основные составляющие:](#в-данной-области-включены-следующие-основные-составляющие)
  - [Создание ER диаграммы](#создание-er-диаграммы)
  - [Пояснение бизнес-логики:](#пояснение-бизнес-логики)
  - [Создание базы данных](#создание-базы-данных)
    - [Тестовые данные](#тестовые-данные)
    - [Запросы](#запросы)
      - [1. Запросы для анализа заявок и услуг](#1-запросы-для-анализа-заявок-и-услуг)
      - [2. Запросы для анализа сотрудников](#2-запросы-для-анализа-сотрудников)
      - [3. Запросы для анализа клиентов](#3-запросы-для-анализа-клиентов)
      - [4. Запросы для финансового анализа](#4-запросы-для-финансового-анализа)
      - [5. Запросы для управления запасами](#5-запросы-для-управления-запасами)
      - [6. Запросы для оперативного управления](#6-запросы-для-оперативного-управления)
      - [7. Анализ качества услуг](#7-анализ-качества-услуг)
      - [8. Сводный отчет по эффективности бизнеса](#8-сводный-отчет-по-эффективности-бизнеса)
      - [9. Запрос для поиска повторяющихся клиентов](#9-запрос-для-поиска-повторяющихся-клиентов)
      - [10. Анализ сезонности услуг](#10-анализ-сезонности-услуг)
  - [Техническое задание на разработку приложения](#техническое-задание-на-разработку-приложения)
    - [1. Общие положения](#1-общие-положения)
      - [1.1. Наименование проекта](#11-наименование-проекта)
      - [1.2. Цель проекта](#12-цель-проекта)
    - [2. Технические требования](#2-технические-требования)
      - [2.1. Технологический стек](#21-технологический-стек)
      - [2.2. Архитектурные требования](#22-архитектурные-требования)
    - [3. Функциональные требования](#3-функциональные-требования)
      - [3.1. Модуль управления заявками](#31-модуль-управления-заявками)
      - [3.2. Модуль клиентов](#32-модуль-клиентов)
      - [3.3. Модуль сотрудников](#33-модуль-сотрудников)
      - [3.4. Модуль учета материалов](#34-модуль-учета-материалов)
      - [3.5. Модуль отчетности](#35-модуль-отчетности)
    - [4. Требования к базе данных](#4-требования-к-базе-данных)
      - [4.1. Подход DB First](#41-подход-db-first)
      - [4.2. Конфигурация подключения](#42-конфигурация-подключения)
    - [5. Интерфейс пользователя](#5-интерфейс-пользователя)
      - [5.1. Общие требования к UI](#51-общие-требования-к-ui)
      - [5.2. Основные экраны](#52-основные-экраны)
        - [5.2.1. Главный экран](#521-главный-экран)
        - [5.2.2. Экран заявок](#522-экран-заявок)
      - [5.2.3. Экран создания заявки](#523-экран-создания-заявки)
    - [6. Техническая реализация](#6-техническая-реализация)
      - [6.1. Структура проекта](#61-структура-проекта)
      - [6.2. Ключевые классы](#62-ключевые-классы)
        - [6.2.1. Модели (генерируются EF)](#621-модели-генерируются-ef)
        - [6.2.2. ViewModels](#622-viewmodels)
        - [6.2.3. Сервисы](#623-сервисы)
    - [6.3. Пример использования SQLCommand](#63-пример-использования-sqlcommand)
    - [7. Требования к качеству](#7-требования-к-качеству)
      - [7.1. Код стайл](#71-код-стайл)
      - [7.2. Обработка ошибок](#72-обработка-ошибок)
      - [7.3. Производительность](#73-производительность)
    - [8. Критерии приемки](#8-критерии-приемки)
      - [8.1. Обязательный функционал](#81-обязательный-функционал)
      - [8.2. Дополнительный функционал (по желанию)](#82-дополнительный-функционал-по-желанию)
    - [9. Этапы разработки](#9-этапы-разработки)
      - [Этап 1: Подготовка](#этап-1-подготовка)
      - [Этап 2: Базовый функционал](#этап-2-базовый-функционал)
      - [Этап 3: Расширенный функционал](#этап-3-расширенный-функционал)
      - [Этап 4: Тестирование и полировка](#этап-4-тестирование-и-полировка)
    - [10. Дополнительные указания](#10-дополнительные-указания)
      - [10.1. Система контроля версий](#101-система-контроля-версий)
      - [10.2. Документация](#102-документация)
      - [Приложения:](#приложения)


## Описание предметной области
Основная цель учёта клининговых услуг - обеспечение высокого качества уборки и удовлетворение запросов клиентов с минимизацией времени ожидания и оптимизацией ресурсов. Эта предметная область широко используется в различных сферах, таких как гостиничный бизнес, офисы, жилые комплексы и другие. Предметная область учёта клининговых услуг касается процесса подачи, обработки и учёта заявок на уборку помещений и предоставление связанных услуг.

### В данной области включены следующие основные составляющие:
1) Заявка на уборку: это информация, предоставленная клиентом о необходимости уборки. Заявка может содержать данные о типе услуги (регулярная уборка, генеральная уборка и т.д.), площади объекта, специфических требованиях и предпочтениях клиента.
2) Регистрация заявки: этот процесс включает приём и регистрацию заявки в системе учёта. Важными аспектами регистрации являются присвоение уникального идентификатора заявке, сохранение информации о клиенте и её приоритете.
3) Обработка заявки: процесс, включающий анализ заявки, определение приоритетности и назначение исполнителя (уборщика) для выполнения задачи. В процессе обработки может потребоваться уточнение деталей уборки у клиента.
4) Исполнение заявки: фактическое выполнение уборки. На этом этапе назначенный исполнитель проводит уборку, использует необходимые материалы и инструменты. Важно отметить, что на этом этапе может возникнуть необходимость в координации работ с другими специалистами или заказе дополнительных материалов.
5) Отчётность и информирование: важной составляющей учёта клининговых услуг является фиксация и отчёт о выполненной работе. После завершения уборки, исполнитель должен предоставить отчёт о проделанной работе, включая информацию о затраченном времени, использованных материалах и уровне удовлетворенности клиента.
6) Мониторинг и анализ: этот этап предполагает контроль и анализ процесса учёта клининговых услуг. Важно отслеживать и анализировать время выполнения заявок, качество услуг, отзывы клиентов и другие параметры, которые могут помочь в оптимизации и улучшении работы клининговой компании.


## Создание ER диаграммы
Разработать ER-диаграмму базы данных для системы учета товаров в зоомагазине.


## Пояснение бизнес-логики:
- Клиент создает Заявку с выбранным типом услуги
- Заявке назначается Статус и Сотрудник
- После выполнения создается Выполнение заявки с затраченным временем
- В процессе выполнения используются Материалы
- После выполнения Клиент оставляет Отзыв о заявке


## Создание базы данных 
Ознакомиться с [материалом](https://github.com/goryachkinama/db-practice/blob/main/src/Lab0.md)

Написать запросы для создания
- Базы данных
- Все таблицы согласно ER-диаграмме
- Связи между таблицами через внешние ключи
- Индексы для улучшения производительности
- Представление для удобного просмотра заявок

Особенности реализации:
- Использовать IDENTITY(1,1) для автоинкремента первичных ключей
- Добавлены проверки (CHECK) для валидации данных
- Создать индексы на часто используемых полях
- Включить ограничения NOT NULL где это необходимо
- Добавить представление для удобства работы с данными
- Для создание первичного ключа и внешних ключей используйте [CONSTRAINT](https://github.com/goryachkinama/db-practice/blob/main/src/Lab0.md)



### Тестовые данные
Комплексные запросы для заполнения базы данных тестовыми данными, которые отражают реальные бизнес-процессы.

- Логически связаны между собой (клиенты создают заявки, сотрудники выполняют их и т.д.)
- Охватывают разные сценарии (разные статусы заявок, приоритеты, типы услуг)
- Включают реалистичные данные с адресами, телефонами, комментариями
- Содержат разнообразные отзывы с разными оценками
- Учитывают использование материалов в разных количествах
- При необходимости добавить представление [(view)](https://github.com/goryachkinama/db-practice/blob/main/src/Lab_view.md)

После выполнения скрипта вы получите полностью рабочую базу данных с тестовыми данными для демонстрации и тестирования функциональности системы учета клининговых услуг.


### Запросы

#### 1. Запросы для анализа заявок и услуг
- Топ-5 самых популярных услуг
- Статистика заявок по статусам

#### 2. Запросы для анализа сотрудников
- Эффективность сотрудников (количество выполненных заявок и среднее время)
- Текущая нагрузка на сотрудников (активные заявки)

#### 3. Запросы для анализа клиентов
- Самые активные клиенты
- Клиенты с самыми высокими оценками

#### 4. Запросы для финансового анализа
- Ежемесячная выручка (по выполненным заявкам)

#### 5. Запросы для управления запасами
- Материалы с низким запасом (меньше 20 единиц)
- Самые используемые материалы

#### 6. Запросы для оперативного управления
- Заявки, требующие внимания (высокий приоритет или просроченные)

#### 7. Анализ качества услуг
- Средние оценки по типам услуг
- Детальный анализ отзывов с комментариями

#### 8. Сводный отчет по эффективности бизнеса

#### 9. Запрос для поиска повторяющихся клиентов

#### 10. Анализ сезонности услуг





## Техническое задание на разработку приложения

### 1. Общие положения
#### 1.1. Наименование проекта
Разработка desktop-приложения "CleaningServiceManager" для автоматизации учета клининговых услуг.

#### 1.2. Цель проекта
Создание современного WPF-приложения для управления заявками на клининговые услуги, учета сотрудников, материалов и анализа эффективности работы.

### 2. Технические требования
#### 2.1. Технологический стек
- Язык программирования: C#
- Платформа: .NET 8.0
- UI Framework: WPF (Windows Presentation Foundation)
- ORM: Entity Framework (DB First подход)
- База данных: MS SQL Server
- Дополнительно: SQLCommand для сложных запросов

#### 2.2. Архитектурные требования
- Паттерн MVVM (Model-View-ViewModel)
- Репозиторный паттерн для доступа к данным
- Внедрение зависимостей (Dependency Injection)

### 3. Функциональные требования
#### 3.1. Модуль управления заявками
Требуется реализовать:
- Просмотр списка заявок с фильтрацией и сортировкой
- Создание/редактирование/удаление заявок
- Изменение статуса заявок
- Назначение сотрудников на заявки
- Поиск заявок по клиенту, дате, статусуЭкранные формы:
- MainWindow - главная панель управления
- RequestListWindow - список заявок
- RequestEditWindow - форма редактирования заявки

#### 3.2. Модуль клиентов
- Требуется реализовать:
- Ведение базы клиентов
- История заявок по клиенту
- Контактная информация клиентов

#### 3.3. Модуль сотрудников
- Требуется реализовать:
- Учет сотрудников
- Назначение на заявки
- Отслеживание загрузки

#### 3.4. Модуль учета материалов
Требуется реализовать:
- Учет остатков материалов
- Списание материалов при выполнении заявок
- Формирование заявок на пополнение запасов

#### 3.5. Модуль отчетности
Требуется реализовать:
- Отчет по выполненным заявкам
- Финансовая отчетность
- Анализ эффективности сотрудников
- Статистика по услугам

### 4. Требования к базе данных
#### 4.1. Подход DB First
- Использовать существующую схему БД из предоставленных SQL-скриптов
- Сгенерировать модели Entity Framework из существующей БД
- Использовать миграции для обновления схемы

#### 4.2. Конфигурация подключения
- Строка подключения в appsettings.json
- Поддержка разных сред (Development/Production)

### 5. Интерфейс пользователя
#### 5.1. Общие требования к UI
- Современный дизайн с использованием MahApps.Metro или аналогичной библиотеки
- Адаптивный layout
- Темная/светлая темы
- Валидация вводимых данных

#### 5.2. Основные экраны
##### 5.2.1. Главный экран
- Меню навигации
- Панель быстрого доступа
- Статистика за сегодня
- Список активных заявок
- 
##### 5.2.2. Экран заявок
- Таблица с заявками
- Фильтры: статус, дата, сотрудник
- Кнопки действий: создать, редактировать, удалить
- Поиск по клиенту и адресу
  
#### 5.2.3. Экран создания заявки
- Выбор клиента (ComboBox с поиском)
- Выбор типа услуги
- Поля: адрес, площадь, особые требования
- Выбор приоритета
  
### 6. Техническая реализация
#### 6.1. Структура проекта
````
CleaningServiceManager/
├── CleaningServiceManager.Core/
│   ├── Models/ (Entity Framework models)
│   ├── ViewModels/
│   ├── Services/
│   └── Repositories/
├── CleaningServiceManager.DAL/
│   ├── DataContext/
│   └── Migrations/
├── CleaningServiceManager.Views/
│   ├── Windows/
│   └── Controls/
└── CleaningServiceManager.Business/
    ├── DTOs/
    └── Logic/
````

#### 6.2. Ключевые классы
##### 6.2.1. Модели (генерируются EF)
````
// Автогенерируемые из БД
public partial class Request { }
public partial class Client { }
public partial class Employee { }
public partial class ServiceType { }
````

##### 6.2.2. ViewModels
````
public class MainViewModel : INotifyPropertyChanged
{
    public ObservableCollection<Request> Requests { get; set; }
    public ICommand CreateRequestCommand { get; }
    public ICommand EditRequestCommand { get; }
}
````

##### 6.2.3. Сервисы
````
public interface IRequestService
{
    Task<List<Request>> GetRequestsAsync();
    Task<Request> CreateRequestAsync(Request request);
    Task UpdateRequestAsync(Request request);
    Task DeleteRequestAsync(int requestId);
}
````

### 6.3. Пример использования SQLCommand
````
public class ReportService
{
    public async Task<FinancialReport> GetFinancialReportAsync(int year, int month)
    {
        var sql = @"
            SELECT 
                SUM(st.cost) as Revenue,
                SUM(mu.cost) as MaterialCosts
            FROM REQUEST r
            JOIN SERVICE_TYPE st ON r.service_type_id = st.service_type_id
            LEFT JOIN MATERIAL_USAGE mu ON ...
            WHERE YEAR(r.created_date) = @Year 
            AND MONTH(r.created_date) = @Month";
        
        using var command = context.Database.GetDbConnection().CreateCommand();
        command.CommandText = sql;
        // параметры и выполнение
    }
}
````

### 7. Требования к качеству
#### 7.1. Код стайл
- Следование conventions C#
- Комментирование публичных методов
- Использование async/await

#### 7.2. Обработка ошибок
- Глобальный обработчик исключений
- Валидация входных данных
- Информативные сообщения об ошибках

#### 7.3. Производительность
- Пагинация для больших списков
- Асинхронные операции
- Кэширование часто используемых данных

### 8. Критерии приемки
#### 8.1. Обязательный функционал
- Работа с заявками (CRUD)
- Управление клиентам
- Назначение сотрудников
- Учет материалов
- Базовые отчеты

#### 8.2. Дополнительный функционал (по желанию)
- Экспорт отчетов в Excel
- Уведомления о просроченных заявках
- Графики и диаграммы
- Роли пользователей

### 9. Этапы разработки
#### Этап 1: Подготовка 
<!-- (1 неделя) -->
- Настройка окружения
- Создание структуры проекта
- Генерация моделей EF из БД

#### Этап 2: Базовый функционал
<!-- (2 недели) -->
- Модуль заявок
- Модуль клиентов
- Базовая навигация

#### Этап 3: Расширенный функционал 
<!-- (2 недели) -->
- Учет материалов
- Отчетность
- Дополнительные фичи

#### Этап 4: Тестирование и полировка 
<!-- (1 неделя) -->
- Тестирование
- Исправление ошибок
- Документация

### 10. Дополнительные указания
#### 10.1. Система контроля версий
- Использование Git
- Осмысленные коммиты
- README с инструкцией по запуску

#### 10.2. Документация
- Комментарии в коде
- Инструкция пользователя
- Описание архитектуры

#### Приложения:
- ER-диаграмма базы данных
- SQL-скрипты создания БД
- Примеры тестовых данных

